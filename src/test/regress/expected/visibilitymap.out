--
-- Visibility Map
--
CREATE TABLE vmtest (i INT primary key);
INSERT INTO vmtest SELECT generate_series(1,10000);
-- All pages are become all-visible
VACUUM FREEZE vmtest;
SELECT relallvisible  = (pg_relation_size('vmtest') / current_setting('block_size')::int) FROM pg_class WHERE relname = 'vmtest';
 ?column? 
----------
 t
(1 row)

-- Check whether vacuum skips all-frozen pages
\set VERBOSITY terse
VACUUM FREEZE VERBOSE vmtest;
INFO:  vacuuming "public.vmtest"
INFO:  index "vmtest_pkey" now contains 10000 row versions in 30 pages
INFO:  skipped 44 frozen pages according to visibility map
INFO:  "vmtest": found 0 removable, 56 nonremovable row versions in 1 out of 45 pages
\set VERBOSITY default
DROP TABLE vmtest;
